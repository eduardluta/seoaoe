generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Email {
  id       String    @id
  runId    String    @unique
  toEmail  String
  sentAt   DateTime?
  status   String
  provider String?
  error    String?
  Run      Run       @relation(fields: [runId], references: [id])

  @@index([status])
}

model Report {
  id        String   @id
  runId     String   @unique
  pdfUrl    String
  sha256    String?
  createdAt DateTime @default(now())
  Run       Run      @relation(fields: [runId], references: [id])
}

model Run {
  id        String      @id
  keyword   String
  domain    String
  country   String
  language  String
  createdAt DateTime    @default(now())
  ipHash    String?
  cacheHit  Boolean     @default(false)
  email     Email?
  report    Report?
  results   RunResult[]

  @@index([createdAt])
  @@index([domain, keyword])
}

model RunResult {
  id                 String   @id
  runId              String
  provider           String
  model              String?
  status             String
  mentioned          Boolean?
  evidence           String?
  firstIndex         Int?
  languageDetected   String?
  countryInterpreted String?
  latencyMs          Int?
  costUsd            Decimal? @db.Decimal(10, 6)
  rawResponse        Json?
  Run                Run      @relation(fields: [runId], references: [id])

  @@index([provider])
  @@index([runId])
}

model BugReport {
  id          String   @id
  name        String
  description String
  createdAt   DateTime @default(now())

  @@index([createdAt])
}
